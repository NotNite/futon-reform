---
import SidebarButton from '../components/SidebarButton.astro';
---

<div class="sidebar-input">
    <input type="checkbox" id="sidebartoggle" name="sidebarcheck"/>
    <div class="overlay"/>
    
    <div class="sidebar-pusher"/>
    
    <div class="sidebar-wrapper">
        <div class="sidebar-header">
            <slot/>
            <span class="sidebar-protip">You can<noscript>'t</noscript> toggle this sidebar by pressing Esc<noscript>. lol.</noscript></span>
        </div>
        <div class="sidebar-inner">
            
            <SidebarButton 
                    link="/"
                    iconName="mingcute:home-7-fill"
            >Home</SidebarButton>
            
            <hr>
            
            <SidebarButton 
                    link="https://bsky.app/profile/yummypillow.art"
                    iconName="simple-icons:bluesky"
                    size="36px"
            >Bluesky</SidebarButton>
            <SidebarButton 
                    link="https://artistree.io/yummypillow"
                    iconName="mingcute:currency-dollar-2-fill"
            >Comms</SidebarButton>
            <SidebarButton 
                    link="mailto:yummypillow.art@gmail.com"
                    iconName="mingcute:mailbox-fill"
            >E-mail</SidebarButton>
            <SidebarButton 
                    link="https://github.com/deadproprietary"
                    iconName="simple-icons:github"
                    size="36px"
            >GitHub</SidebarButton>
            <SidebarButton 
                    link="https://piczel.tv/watch/yummypillow"
                    iconName="mingcute:tv-2-fill"
            >Piczel.tv</SidebarButton>
            
            <hr>
            
            <SidebarButton 
                    link="/faq"
                    iconName="mingcute:question-line"
            >FAQ</SidebarButton>
            <SidebarButton 
                    link="/blog"
                    iconName="mingcute:paper-line"
            >Blog</SidebarButton>
            <SidebarButton 
                    link="/credits"
                    iconName="mingcute:user-heart-fill"
            >Credits</SidebarButton>
            
        </div>
        <div class="sidebar-footer">
            <p>This site was written from scratch in <a class="out" href="https://astro.build">Astro.</a></p>
            <p>Hosted on GitHub Pages. Thanks for visiting!</p>
        </div>
    </div>
    
    <div class="sidebar-button"/>
    
    <div class="buttonline1" style="--i:1;"/>
    <div class="buttonline2" style="--i:2;"/>
    <div class="buttonline3" style="--i:3;"/>
    <div class="buttonline4" style="--i:4;"/>
    
    <div class="sidebar-arrow" />
    
    <div class="linktext"><span class="links">LINKS</span></div>
    
</div>

<style>
    @keyframes mover {
        0% {opacity: 100%; transform: translateX(0px);}
        85% {opacity: 1%;}
        100% {opacity: 1%; transform: translateX(12px);}
    }
    @keyframes mover2 {
        0% {opacity: 100%; transform: translateX(0px);}
        85% {opacity: 1%;}
        100% {opacity: 1%; transform: translateX(20px);}
    }
    
    .sidebar-header {
        margin: 10px;
    }
    .sidebar-protip {
        position: relative;
        top: 1.5rem;
        font-size: 0.7rem;
        line-height: 0.6rem;
        color: #9989a3;
        
        span {
            color: #8a4e4e;
        }
    }

    .sidebar-inner {
        position: absolute;
        display: flex;
        flex-direction: column;
        justify-content: space-evenly;
        top: 50vh;
        right: 0;
        width: 90%;
        transform: translateY(-50%);
        margin: 8px 8px 0 16px;
    }

    .sidebar-footer {
        position: absolute;
        bottom: 0;
        margin: 8px;

        p, a {
            font-size: 11px;
            color: #695d71;
        }
    }

    /* ------------ */
    :root {
        --transition: 0.163s;
        --lineduration: 2s;
        font-family: 'Atkinson Hyperlegible';
    }
    
    h3 {
        font-size: 12px;
    }

    .sidebar-pusher {
        transition: var(--transition);
        animation-timing-function: ease-out;
        position: relative;
        width: 0;
    }
    .sidebar-input input:hover ~ .sidebar-pusher {
        width: 13px;
    }
    .sidebar-input input[type="checkbox"]:checked ~ .sidebar-pusher {
        width: 260px;
    }

    .sidebar-wrapper{
        transition: var(--transition);
        animation-timing-function: ease-out;
        position: fixed;
        top: 0;
        left: -250px;
        width: 250px;
        height: 100vh;
        display: flex;
        z-index: 99;
        flex-direction: column;
        justify-content: space-between;
        background:#1e1d21;

    }
    
    /* FUCK */
    .sidebar-input input[type="checkbox"] {
        opacity: 0;
        position: fixed;
        left: 0;
        top: 0;
        height: 100vh;
        width: 50px;
        z-index: 999;
        cursor: e-resize;
    }
    .sidebar-button {
        transition: var(--transition);
        animation-timing-function: ease-out;
        position: fixed;
        top: 0;
        left: -1px;
        width: 7px;
        height: 100vh;
        background: linear-gradient(90deg, rgba(30,29,33,1) 90%, rgba(211,195,233,1) 100%);
        z-index: 98;
        filter: drop-shadow(0px 0px 8px #d3c3e9);
    }
    .sidebar-input input:hover ~ .sidebar-button {
        width: 20px;
        filter: drop-shadow(0px 0px 14px rgba(211, 195, 233, 0.97));
    }
    .sidebar-input input[type="checkbox"]:checked ~ .sidebar-button {
        left: 245px;
        width: 25px;
    }

    .buttonline1, .buttonline2, .buttonline3, .buttonline4 {
        transition: var(--transition);
        position: fixed;
        top: 0;
        left: 5px;
        height: 100vh;
        width: 1px;
        z-index: 99;
        pointer-events: none;
        background: rgba(211, 195, 233, 0.38);
        animation-name: "mover";
        animation-duration: var(--lineduration);
        animation-fill-mode: backwards;
        animation-iteration-count: infinite;
        animation-delay: calc((var(--lineduration)/4) * var(--i) - 3s);
        -webkit-animation: mover var(--lineduration) backwards infinite;
        -webkit-animation-delay: calc((var(--lineduration)/4) * var(--i) - 3s);
    }
    .sidebar-input input:hover ~ .buttonline1,
    .sidebar-input input:hover ~ .buttonline2,
    .sidebar-input input:hover ~ .buttonline3,
    .sidebar-input input:hover ~ .buttonline4 {
        left: 18px;
        animation-name: "mover2";
        animation-duration: calc(var(--lineduration)/2);
        animation-delay: calc((var(--lineduration)/8) * var(--i) - 3s);
        -webkit-animation-name: mover2;
        -webkit-animation-duration: calc(var(--lineduration)/2);
        -webkit-animation-delay: calc((var(--lineduration)/8) * var(--i) - 3s);
    }
    .sidebar-input input[type="checkbox"]:checked ~ .buttonline1,
    .sidebar-input input[type="checkbox"]:checked ~ .buttonline2,
    .sidebar-input input[type="checkbox"]:checked ~ .buttonline3,
    .sidebar-input input[type="checkbox"]:checked ~ .buttonline4 {
        left: 268px;
    }

    .sidebar-arrow {
        transition: var(--transition);
        z-index: 100;
        position: fixed;
        top: 50vh; left: 16px;
        opacity: 1;
        transform: translateY(-50%);
        width: 0; height: 0;
        border-top: 25px solid transparent;
        border-bottom: 25px solid transparent;
        border-left: 13px solid #131219;
        filter:
                drop-shadow(1px 0px 0px #d3c3e970)
                drop-shadow(0px 1px 0px #d3c3e970)
                drop-shadow(-1px 0px 0px #d3c3e970)
                drop-shadow(0px -1px 0px #d3c3e970);
    }
    .sidebar-input input:hover ~ .sidebar-arrow {
        opacity: 0;
    }
    .sidebar-input input[type="checkbox"]:checked ~ .sidebar-arrow {
        opacity: 0;
    }

    .linktext {
        transition: var(--transition);
        pointer-events: none;
        font-weight: bold;
        font-size: 48px;
        position: fixed;
        color: #1e1d21;
        left: -2px;
        top: 50vh;
        writing-mode: sideways-lr;
        transform: translateY(-50%);
        letter-spacing: -0.05rem;
        opacity: 0;
        z-index: 100;
        filter: drop-shadow(0px 1px 0px #d3c3e990)
                drop-shadow(1px 0px 0px #d3c3e990)
                drop-shadow(-1px 0px 0px #d3c3e990)
                drop-shadow(0px -1px 0px #d3c3e990);
    }
    .sidebar-input input:hover ~ .linktext {
        opacity: 100%;
        left: 10px;
    }
    .sidebar-input input[type="checkbox"]:checked ~ .linktext {
        left: 263px;
        opacity: 100%;
    }

    .overlay {
        transition: var(--transition);
        position: fixed;
        top: 0; left: 0;
        height: 100vh; width: 100%;
        background: #000;
        z-index: 97;
        opacity: 0;
        pointer-events: none;
    }

    .sidebar-input input[type="checkbox"]:checked {
        left: 260px;
        width: 100%;
        height: 100vh;
    }
    .sidebar-input input[type="checkbox"]:checked ~ .sidebar-wrapper {
        left: 0;
    }
    .sidebar-input input[type="checkbox"]:checked ~ .overlay {
        opacity: 40%;
    }

    /* -------------- */

    .nottheme-div-sidebar {
        position: absolute !important;
        left: 0;
    }
    
    @media (max-height: 560px){
        .sidebar-inner {
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 10px;
            row-gap: 5vh;
            margin: 0;
        }
        
        hr {
            display: none;
        }
    }
    
    @media (max-width: 730px) or (orientation: portrait) {
        .sidebar-protip {
            visibility: hidden;
        }
        
        /* hover */
        .sidebar-input input:hover ~ .sidebar-pusher {
            width: 0;
        }
        .sidebar-input input:hover ~ .sidebar-button {
            width: 7px;
            filter: drop-shadow(0px 0px 8px #d3c3e9);
        }
        .sidebar-input input:hover ~ .buttonline1,
        .sidebar-input input:hover ~ .buttonline2,
        .sidebar-input input:hover ~ .buttonline3,
        .sidebar-input input:hover ~ .buttonline4 {
            left: 5px;
            animation-name: "mover";
            animation-duration: var(--lineduration);
            animation-fill-mode: backwards;
            animation-iteration-count: infinite;
            animation-delay: calc((var(--lineduration) / 4) * var(--i) - 3s);
            -webkit-animation: mover var(--lineduration) backwards infinite;
            -webkit-animation-delay: calc((var(--lineduration)/4) * var(--i) - 3s);
        }
        .sidebar-input input:hover ~ .sidebar-arrow {
            opacity: 100%;
        }
        .sidebar-input input:hover ~ .linktext {
            opacity: 0;
            left: 0;
        }
        
        /* checked */
        .sidebar-input input[type="checkbox"]:checked ~ .sidebar-button {
            filter: drop-shadow(0px 0px 14px rgba(211, 195, 233, 0.97));
        }
        .sidebar-input input[type="checkbox"]:checked ~ .buttonline1,
        .sidebar-input input[type="checkbox"]:checked ~ .buttonline2,
        .sidebar-input input[type="checkbox"]:checked ~ .buttonline3,
        .sidebar-input input[type="checkbox"]:checked ~ .buttonline4 {
            left: 268px;
            animation-name: "mover2";
            animation-duration: calc(var(--lineduration)/2);
            animation-delay: calc((var(--lineduration)/8) * var(--i) - 3s);
            -webkit-animation-name: mover2;
        }
    }
</style>

<script>
    // escape to toggle sidebar
    document.addEventListener('keydown', function (e) {
        if (e.code === "Escape") {
            document.getElementById('sidebartoggle').click();
        }
    })

    // mobile swipe to open
    // https://stackoverflow.com/questions/45648886/swipe-left-right-for-a-webpage
    let start = null;
    window.addEventListener("touchstart",function(e){
        if(e.touches.length === 1){
            start = e.touches.item(0).clientX;
        }else{
            start = null;
        }
    });
    window.addEventListener("touchend",function(e){
        let threshold = 80; //px
        if(start && !document.getElementById('sidebartoggle').checked) {
            let end = e.changedTouches.item(0).clientX;
            if (end > start + threshold) {
                document.getElementById('sidebartoggle').click();
            }
        } 
        else if (start && document.getElementById('sidebartoggle').checked) {
            let end = e.changedTouches.item(0).clientX;
            if(end < start - threshold ){
                document.getElementById('sidebartoggle').click();
            }
        }
    });
</script>
